<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
  <title>Ho Huu An - Graduation Invitation</title>
  <link rel="icon" type="image/x-icon" href="images/logo.png" />
  <link rel="stylesheet" href="style.css" />
  <link rel="stylesheet" href="star.css" />
</head>

<body>
  <!-- Background Image with Overlay -->
  <div class="bg"></div>   
  
  <!-- Starfield with Multiple Layers -->
  <div class="star-field">
    <div class="layer"></div>
    <div class="layer"></div>
    <div class="layer"></div>
  </div>
  
  <!-- Animated Stars with Tails -->
  <div class="stars">
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
    <div class="star"></div>
  </div>

  <!-- Navigation Buttons -->
  <button id="prev-btn" class="nav-button">‹</button>
  <button id="next-btn" class="nav-button">›</button>

  <div class="flipbook">
    <div class="hard"><img src="pages/1.png" alt="Page 1"></div>
    <div class=""><img src="pages/2.png" alt="Page 2"></div>
    <div class=""><img src="pages/3.png" alt="Page 3"></div>
    <div class=""><img src="pages/4.png" alt="Page 4"></div>
    <div class=""><img src="pages/5.png" alt="Page 5"></div>
    <div class=""><img src="pages/6.png" alt="Page 6"></div>
    <div class=""><img src="pages/7.png" alt="Page 7"></div>
    <div class=""><img src="pages/8.png" alt="Page 8"></div>
    <!-- <div class="hard hard-back"></div> -->
  </div>

  <!-- Background Music -->
  <audio id="background-music" loop>
    <source src="sounds/background.mp3" type="audio/mpeg">
  </audio>

  <script src="jquery.js"></script>
  <script src="turn.js"></script>
  <script>
    $(document).ready(function () {
      // Auto play background music
      const bgMusic = document.getElementById('background-music');
      bgMusic.volume = 0.3;

      // Try to auto-play (may be blocked by browser)
      setTimeout(function () {
        bgMusic.play().catch(function (error) {
          console.log('Auto-play was prevented. Music will play on first interaction.');
        });
      }, 100);

      // Start music on first user interaction
      function startMusic() {
        bgMusic.play().catch(function (error) {
          console.log('Audio play failed:', error);
        });
      }

      // Calculate book size - maximize height
      const windowHeight = $(window).height();
      const windowWidth = $(window).width();

      // Detect mobile devices
      const isMobile = windowWidth <= 768;

      // Use full available height minus padding
      const bookHeight = windowHeight - 80;
      const bookWidth = bookHeight * 1.5; // 3:2 ratio for double page

      let finalWidth = bookWidth;
      let finalHeight = bookHeight;

      // If book is too wide for screen, scale down
      if (bookWidth > windowWidth - 200) {
        finalWidth = windowWidth - 200;
        finalHeight = finalWidth / 1.5;
      }

      // Initialize the flipbook
      const flipbookOptions = {
        autoCenter: true,
        elevation: 50,
        gradients: true,
        duration: 1500,
        pages: 8,
        acceleration: true,
        display: isMobile ? 'single' : 'double',
        
        when: {
          turning: function (event, page, view) {
            startMusic();
            updatePageInfo(page);
          },
          turned: function (event, page, view) {
            // Switch to double page view after first page
            // if (page >= 2) {
            //   $(".flipbook").turn("display", "double");
            // }
          },
          start: function (event, pageObject, corner) {
            startMusic();
          }
        }
      };

      // Add width and height only for desktop
      if (!isMobile) {
        flipbookOptions.width = finalWidth;
        flipbookOptions.height = finalHeight;
      }

      $(".flipbook").turn(flipbookOptions);
      
      // Hide hard back cover on mobile
      if (isMobile) {
        $('.hard-back').hide();
      }
      
      startMusic();
      // Update page navigation buttons
      function updatePageInfo(page) {
        if (page === 1) {
          $('#prev-btn').prop('disabled', true);
        } else {
          $('#prev-btn').prop('disabled', false);
        }

        if (page === $('.flipbook').turn('pages')) {
          $('#next-btn').prop('disabled', true);
        } else {
          $('#next-btn').prop('disabled', false);
        }
      }

      // Previous button
      $('#prev-btn').click(function (e) {
        e.stopPropagation();
        startMusic();
        $(".flipbook").turn("previous");
      });

      // Next button
      $('#next-btn').click(function (e) {
        e.stopPropagation();
        startMusic();
        $(".flipbook").turn("next");
      });

      // Keyboard navigation
      $(document).keydown(function (e) {
        startMusic();
        if (e.keyCode === 37) { // Left arrow
          $(".flipbook").turn("previous");
        } else if (e.keyCode === 39) { // Right arrow
          $(".flipbook").turn("next");
        }
      });

      // Initialize page info
      updatePageInfo(1);

      // Responsive handling
      $(window).resize(function () {
        const windowHeight = $(window).height();
        const windowWidth = $(window).width();
        const isMobileResize = windowWidth <= 768;

        const bookHeight = windowHeight - 80;
        const bookWidth = bookHeight * 1.5;

        let newWidth = bookWidth;
        let newHeight = bookHeight;

        if (bookWidth > windowWidth - 200) {
          newWidth = windowWidth - 200;
          newHeight = newWidth / 1.5;
        }

        // Only set size for desktop, mobile handles it automatically
        if (!isMobileResize) {
          $(".flipbook").turn("size", newWidth, newHeight);
          $('.hard-back').show();
        } else {
          $('.hard-back').hide();
        }

        // Update display mode based on screen size
        $(".flipbook").turn("display", isMobileResize ? "single" : "double");
      });

    });
  </script>
</body>

</html>